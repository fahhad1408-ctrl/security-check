<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            background: #0a0a0a; 
            color: #ffffff; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            text-align: center; 
            padding: 20px;
            margin: 0;
        }
        .container { max-width: 400px; margin: auto; }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .loader-box { margin: 50px auto; }
        .spinner {
            width: 60px; height: 60px;
            border: 5px solid #222;
            border-top: 5px solid #0088cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .card {
            background: #161616;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #222;
        }
        .info-item:last-child { border: none; }
        
        .label { color: #888; font-size: 0.9rem; }
        .value { font-weight: bold; }
        
        .safe { color: #00ff88; }
        .danger { color: #ff4444; }

        h2 { margin-top: 20px; font-size: 1.5rem; }
        .btn-retry {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="loading-screen" class="loader-box">
        <div class="spinner"></div>
        <h3 id="load-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù‚Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ...</h3>
        <p id="percent">0%</p>
    </div>

    <div id="result-card" class="card">
        <h3 style="margin-top:0; color:#0088cc;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ</h3>
        
        <div class="info-item">
            <span class="label">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</span>
            <span id="device" class="value">..</span>
        </div>
        <div class="info-item">
            <span class="label">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„:</span>
            <span id="os" class="value">..</span>
        </div>
        <div class="info-item">
            <span class="label">Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„ØªÙ„Ø§Ø¹Ø¨:</span>
            <span id="mock-status" class="value">..</span>
        </div>
        
        <h2 id="verdict">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..</h2>
        <button id="retry-btn" class="btn-retry" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„ØªØ´ØºÙ„ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø©

    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += Math.floor(Math.random() * 15) + 1;
        if (progress >= 100) {
            progress = 100;
            clearInterval(progressInterval);
            startLocationCheck();
        }
        document.getElementById('percent').innerText = progress + "%";
    }, 150);

    function startLocationCheck() {
        // ÙØ­Øµ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
        const ua = navigator.userAgent;
        document.getElementById('device').innerText = /iPhone|iPad/i.test(ua) ? "iPhone" : "Android";
        document.getElementById('os').innerText = navigator.platform;

        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒØ§Ø±Øª ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('result-card').style.display = 'block';

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const accuracy = position.coords.accuracy;
                    // ÙƒØ´Ù Ø§Ù„ØªÙ„Ø§Ø¹Ø¨: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¯Ù‚Ø© 0 Ø£Ùˆ Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø¬Ø¯Ø§Ù‹
                    const isMocked = position.coords.accuracy <= 0 || navigator.webdriver;

                    if (isMocked) {
                        setResult("Ù…ÙƒØªØ´Ù ğŸš©", "Ù…Ø´Ø¨ÙˆÙ‡ ğŸš«", "danger");
                        tg.HapticFeedback.notificationOccurred('error');
                    } else {
                        setResult("Ù„Ø§ ÙŠÙˆØ¬Ø¯ âœ…", "Ø³Ù„ÙŠÙ… âœ…", "safe");
                        tg.HapticFeedback.notificationOccurred('success');
                    }
                },
                (error) => {
                    document.getElementById('verdict').innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙˆÙ‚Ø¹";
                    document.getElementById('verdict').className = "danger";
                    document.getElementById('retry-btn').style.display = "inline-block";
                    tg.HapticFeedback.notificationOccurred('warning');
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
            );
        } else {
            document.getElementById('verdict').innerText = "Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ÙØ­Øµ";
        }
    }

    function setResult(mockText, verdictText, className) {
        document.getElementById('mock-status').innerText = mockText;
        document.getElementById('mock-status').className = "value " + className;
        document.getElementById('verdict').innerText = verdictText;
        document.getElementById('verdict').className = className;
    }
</script>

</body>
</html>
