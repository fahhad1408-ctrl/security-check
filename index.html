<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ù…Ù†ÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #121212; --danger: #ff4d4d; --safe: #00ff88; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; padding: 15px; text-align: center; }
        .radar { width: 80px; height: 80px; border: 3px solid var(--primary); border-radius: 50%; margin: 40px auto; border-left-color: transparent; animation: spin 0.8s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .report-card { background: var(--card); border-radius: 15px; padding: 20px; display: none; border: 1px solid #222; }
        .row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #1f1f1f; font-size: 14px; }
        .label { color: #888; }
        .verdict-box { margin-top: 15px; padding: 15px; border-radius: 10px; font-weight: bold; }
        .v-safe { background: rgba(0,255,136,0.1); color: var(--safe); border: 1px solid var(--safe); }
        .v-danger { background: rgba(255,77,77,0.1); color: var(--danger); border: 1px solid var(--danger); }
    </style>
</head>
<body>

<h2 id="title">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø³Ø±ÙŠØ¹...</h2>

<div id="loader">
    <div class="radar"></div>
    <p>ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¢Ù†</p>
</div>

<div id="report" class="report-card">
    <div class="row"><span class="label">Ù…Ø²ÙˆØ¯ Ø§Ù„Ø´Ø¨ÙƒØ©:</span><span id="isp">..</span></div>
    <div class="row"><span class="label">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ:</span><span id="loc">..</span></div>
    <div class="row"><span class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ù€ GPS:</span><span id="gps">ÙØ­Øµ Ø¯Ù‚ÙŠÙ‚ âœ…</span></div>
    <div id="verdict" class="verdict-box">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...</div>
    <button onclick="location.reload()" style="margin-top:15px; background:#222; color:#fff; border:1px solid #333; padding:8px 20px; border-radius:5px;">ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ­Øµ</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function startFastCheck() {
        let issues = 0;

        // 1. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù€ IP Ù…Ø¹ "ØªØ§ÙŠÙ… Ø¢ÙˆØª" 2 Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø· Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2000);

        fetch('https://ipapi.co/json/', { signal: controller.signal })
            .then(res => res.json())
            .then(data => {
                document.getElementById('isp').innerText = data.org || "Ø´Ø¨ÙƒØ© Ø®Ø§ØµØ©";
                document.getElementById('loc').innerText = data.city || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
            })
            .catch(() => {
                document.getElementById('isp').innerText = "ØªØ¬Ø§ÙˆØ² Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ âœ…";
                document.getElementById('loc').innerText = "Ù…ØªØµÙ„";
            });

        // 2. ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø£Ù‡Ù…)
        navigator.geolocation.getCurrentPosition(pos => {
            if(pos.coords.accuracy < 1 || pos.coords.altitude === 0) issues += 2;
            showResults(issues);
        }, () => {
            showResults(1); // ÙÙŠ Ø­Ø§Ù„ Ø±ÙØ¶ Ø§Ù„ØªØµØ±ÙŠØ­
        }, { enableHighAccuracy: true, timeout: 4000 });
    }

    function showResults(issues) {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('report').style.display = 'block';
        document.getElementById('title').innerText = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù†";
        
        const v = document.getElementById('verdict');
        if(issues === 0) {
            v.innerText = "Ø¬Ù‡Ø§Ø²Ùƒ Ø³Ù„ÙŠÙ… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ…";
            v.className = "verdict-box v-safe";
            tg.HapticFeedback.notificationOccurred('success');
        } else {
            v.innerText = "ØªÙ†Ø¨ÙŠÙ‡: ØªÙ… Ø±ØµØ¯ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ø§Ø¹Ø¨ ğŸš©";
            v.className = "verdict-box v-danger";
            tg.HapticFeedback.notificationOccurred('error');
        }
    }

    // ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ Ø¥Ù„Ù‰ 0.5 Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·
    setTimeout(startFastCheck, 500);
</script>
</body>
</html>
