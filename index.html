<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #111; --danger: #ff4d4d; --safe: #00ff88; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; overflow: hidden; }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #start-screen { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; text-align: center; padding: 20px; }
        .start-btn { background: var(--primary); color: #000; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 0 20px rgba(0, 209, 255, 0.4); }
        
        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #main-content { display: none; }
        .report { background: var(--card); border-radius: 15px; padding: 15px; border: 1px solid #222; margin-top: 10px; }
        .item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #1f1f1f; font-size: 13px; }
        .val { font-weight: bold; color: var(--primary); }
        .verdict { margin-top: 20px; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; border: 1px solid #333; }
        
        .loading-ring { width: 60px; height: 60px; border: 3px solid #222; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="start-screen">
    <div style="font-size: 50px; margin-bottom: 20px;">ğŸ›¡ï¸</div>
    <h2 style="margin-bottom: 10px;">Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</h2>
    <p style="color: #888; margin-bottom: 30px; font-size: 14px;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¨Ø¯Ø¡ ØªØ­Ù„ÙŠÙ„ Ø£Ù…Ø§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</p>
    <button class="start-btn" onclick="initiateAudit()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="main-content">
    <h3 id="top-title" style="text-align:center;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</h3>
    <div id="loader" class="loading-ring"></div>

    <div id="report" class="report" style="display:none;">
        <div style="color:var(--primary); font-size:12px; margin-bottom:10px; border-bottom:1px solid #333;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ø´Ø¨ÙƒØ©</div>
        <div class="item"><span>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</span><span id="device" class="val">..</span></div>
        <div class="item"><span>Ø§Ù„Ø¯ÙˆÙ„Ø©:</span><span id="country" class="val">..</span></div>
        <div class="item"><span>Ø§Ù„Ø­ÙŠ/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</span><span id="location" class="val">..</span></div>
        <div class="item"><span>Ø­Ø§Ù„Ø© Ø§Ù„Ù€ VPN:</span><span id="vpn" class="val">..</span></div>
        <div class="item"><span>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±:</span><span id="dev" class="val">..</span></div>
        
        <div id="final-verdict" class="verdict">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬..</div>
        <button onclick="location.reload()" style="width:100%; padding:10px; margin-top:15px; background:none; border:1px solid #333; color:#555; border-radius:8px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function initiateAudit() {
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        
        // Ù‡Ø² Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        tg.HapticFeedback.impactOccurred('heavy');

        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù‡Ù†Ø§ ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…)
        navigator.geolocation.getCurrentPosition(async (pos) => {
            await runFullCheck(pos.coords);
        }, (err) => {
            handleError();
        }, { enableHighAccuracy: true });
    }

    async function runFullCheck(coords) {
        let risk = 0;
        
        // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
        document.getElementById('device').innerText = /iPhone|iPad/i.test(navigator.userAgent) ? "iPhone" : "Android";
        
        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ (Ø§Ù„Ø­ÙŠ)
        try {
            const geo = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${coords.latitude}&lon=${coords.longitude}&accept-language=ar`);
            const gData = await geo.json();
            document.getElementById('location').innerText = gData.address.suburb || gData.address.city || "Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚";
        } catch(e) {}

        // 3. Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù€ VPN
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            document.getElementById('country').innerText = data.country_name;
            
            const offset = new Date().getTimezoneOffset();
            if (offset !== -180 || data.country_code !== 'SA') {
                document.getElementById('vpn').innerText = "Ù†Ø´Ø· ğŸš©";
                risk += 2;
            } else {
                document.getElementById('vpn').innerText = "ØºÙŠØ± Ù†Ø´Ø· âœ…";
            }
        } catch(e) { risk++; }

        // 4. ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±
        document.getElementById('dev').innerText = navigator.webdriver ? "Ù…ÙØ¹Ù„ ğŸš©" : "Ù…ØºÙ„Ù‚ âœ…";
        if(navigator.webdriver) risk += 2;

        showFinal(risk);
    }

    function showFinal(risk) {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('report').style.display = 'block';
        document.getElementById('top-title').innerText = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ";
        
        const v = document.getElementById('final-verdict');
        if(risk === 0) {
            v.innerText = "Ø§Ù„Ø¬Ù‡Ø§Ø² Ø³Ù„ÙŠÙ… ÙˆØ¢Ù…Ù† âœ…";
            v.style.color = "#00ff88";
            tg.HapticFeedback.notificationOccurred('success');
        } else {
            v.innerText = "ØªØ­Ø°ÙŠØ±: ØªÙ… Ø±ØµØ¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø© âš ï¸";
            v.style.color = "#ff4d4d";
            tg.HapticFeedback.notificationOccurred('error');
        }
    }

    function handleError() {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('top-title').innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª";
        document.getElementById('main-content').innerHTML += `<div class='verdict' style='color:#ff4d4d'>ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ. ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„Ù‡ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„ÙŠØ¬Ø±Ø§Ù… ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.</div>`;
    }
</script>
</body>
</html>
