<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #111; --danger: #ff4d4d; --safe: #00ff88; --warning: #ffcc00; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; }
        .report { background: var(--card); border-radius: 15px; padding: 15px; border: 1px solid #222; margin-top: 20px; }
        .item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #222; font-size: 13px; }
        .val { color: var(--primary); font-weight: bold; text-align: left; }
        .verdict { margin-top: 20px; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; border: 1px solid #333; }
        #start-screen { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; text-align: center; }
        .btn { background: var(--primary); color: #000; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>

<div id="start-screen">
    <h2 style="margin-bottom: 20px;">ğŸ›¡ï¸ Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</h2>
    <button class="btn" onclick="startDeepAudit()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="main-content" style="display:none;">
    <h3 style="text-align:center;">ØªÙ‚Ø±ÙŠØ± Ø£Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ø´Ø¨ÙƒØ©</h3>
    <div class="report">
        <div class="item"><span>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</span><span id="device" class="val">..</span></div>
        <div class="item"><span>Ø§Ù„Ø¯ÙˆÙ„Ø© (Ø§Ù„Ø´Ø¨ÙƒØ©):</span><span id="country" class="val">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨..</span></div>
        <div class="item"><span>Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø©:</span><span id="isp" class="val">..</span></div>
        <div class="item"><span>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (GPS):</span><span id="location" class="val">..</span></div>
        <div class="item"><span>ÙƒØ´Ù Ø§Ù„Ù€ VPN:</span><span id="vpn" class="val">..</span></div>
        <div class="item"><span>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±:</span><span id="dev" class="val">..</span></div>
        <div id="verdict" class="verdict">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function startDeepAudit() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        tg.HapticFeedback.impactOccurred('medium');

        let risk = 0;
        let vpnFlag = false;

        // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ© (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø³ÙŠØ±ÙØ±ÙŠÙ† Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©)
        try {
            const res = await fetch('https://ipapi.co/json/').catch(() => fetch('https://ipinfo.io/json?token=7ba0a7c473729e'));
            const data = await res.json();
            document.getElementById('country').innerText = data.country_name || data.country;
            document.getElementById('isp').innerText = data.org || "Ù…Ø®ÙÙŠ";
            
            // ÙØ­Øµ Ø§Ù„Ù€ VPN (ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© GMT+3 Ù‡Ùˆ -180)
            const offset = new Date().getTimezoneOffset();
            if (offset !== -180 || (data.country_code !== 'SA' && data.country !== 'SA')) {
                vpnFlag = true;
                risk += 2;
            }
        } catch(e) { risk += 0.5; }

        // 2. ÙØ­Øµ Ø§Ù„Ù€ GPS ÙˆØ§Ù„Ø­ÙŠ
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const coords = pos.coords;
            document.getElementById('vpn').innerText = vpnFlag ? "Ù†Ø´Ø· ğŸš©" : "ØºÙŠØ± Ù†Ø´Ø· âœ…";
            
            try {
                const geo = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${coords.latitude}&lon=${coords.longitude}&accept-language=ar`);
                const gData = await geo.json();
                document.getElementById('location').innerText = gData.address.suburb || gData.address.city || "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯";
            } catch(e) {}

            // 3. ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± ÙˆÙ‡ÙÙˆÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²
            document.getElementById('device').innerText = /iPhone|iPad/i.test(navigator.userAgent) ? "Apple iPhone" : "Android Device";
            document.getElementById('dev').innerText = navigator.webdriver ? "Ù…ÙØ¹Ù„ ğŸš©" : "Ù…ØºÙ„Ù‚ âœ…";
            if(navigator.webdriver) risk += 2;

            // Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            const v = document.getElementById('verdict');
            if (risk < 2) {
                v.innerText = "Ø§Ù„Ø¬Ù‡Ø§Ø² Ø³Ù„ÙŠÙ… ÙˆØ¢Ù…Ù† âœ…";
                v.style.borderColor = "#00ff88"; v.style.color = "#00ff88";
            } else {
                v.innerText = "ØªØ­Ø°ÙŠØ±: ØªÙ… Ø±ØµØ¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø© âš ï¸";
                v.style.borderColor = "#ff4d4d"; v.style.color = "#ff4d4d";
            }
        }, () => {
            document.getElementById('verdict').innerText = "Ø®Ø·Ø£: ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„ÙØ­Øµ";
        }, { enableHighAccuracy: true });
    }
</script>
</body>
</html>
