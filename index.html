<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #121212; --danger: #ff4d4d; --safe: #00ff88; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; padding: 15px; overflow-x: hidden; }
        .header { margin: 20px 0; text-align: center; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 50px; font-size: 12px; background: #222; border: 1px solid #333; margin-bottom: 10px; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠØ© */
        #loader { text-align: center; padding: 50px 0; }
        .radar { width: 100px; height: 100px; border: 2px solid var(--primary); border-radius: 50%; margin: 0 auto 20px; position: relative; border-left-color: transparent; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠ */
        .report-card { background: var(--card); border-radius: 15px; padding: 20px; display: none; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        .row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #1f1f1f; font-size: 14px; }
        .row:last-child { border: none; }
        .label { color: #888; }
        .val { font-weight: bold; color: #ddd; }
        
        .verdict-box { margin-top: 20px; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 18px; }
        .v-safe { background: rgba(0,255,136,0.1); color: var(--safe); border: 1px solid var(--safe); }
        .v-danger { background: rgba(255,77,77,0.1); color: var(--danger); border: 1px solid var(--danger); }
        
        .pulse { animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="header">
    <div class="status-badge">Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ù†Ø³Ø®Ø© 2.0 (Ø§Ø­ØªØ±Ø§ÙÙŠ)</div>
    <h2 id="main-title">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø²...</h2>
</div>

<div id="loader">
    <div class="radar"></div>
    <p id="step">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©...</p>
</div>

<div id="report" class="report-card">
    <div class="row"><span class="label">Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø© (ISP):</span><span id="isp" class="val">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨...</span></div>
    <div class="row"><span class="label">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø¨ÙƒØ© (IP):</span><span id="ip-loc" class="val">..</span></div>
    <div class="row"><span class="label">ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</span><span id="tz-check" class="val">..</span></div>
    <div class="row"><span class="label">ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ù€ GPS:</span><span id="gps-jitter" class="val">..</span></div>
    <div class="row"><span class="label">Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„:</span><span id="env-status" class="val">Ø£ØµÙ„ÙŠØ© âœ…</span></div>
    <div class="row"><span class="label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©:</span><span id="batt" class="val">..</span></div>

    <div id="verdict" class="verdict-box">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ...</div>
    <button onclick="location.reload()" style="background:none; border:1px solid #333; color:#888; margin-top:15px; width:100%; padding:10px; border-radius:8px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function runAdvancedCheck() {
        let issues = 0;
        
        try {
            // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù€ IP ÙˆØ§Ù„Ù€ VPN Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©
            const ipRes = await fetch('https://ipapi.co/json/');
            const ipData = await ipRes.json();
            document.getElementById('isp').innerText = ipData.org;
            document.getElementById('ip-loc').innerText = ipData.country_name + " - " + ipData.city;

            // 2. ÙØ­Øµ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© (ÙƒØ´Ù Ø§Ù„Ù€ VPN)
            const localTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if(!localTZ.includes(ipData.timezone.split('/')[1])) {
                document.getElementById('tz-check').innerText = "ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ ğŸš©";
                document.getElementById('tz-check').style.color = "var(--danger)";
                issues++;
            } else {
                document.getElementById('tz-check').innerText = "Ù…ØªØ·Ø§Ø¨Ù‚ âœ…";
            }

            // 3. ÙØ­Øµ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© (Ø¥Ø¶Ø§ÙØ© Ù…ØµØ¯Ø§Ù‚ÙŠØ©)
            if (navigator.getBattery) {
                const b = await navigator.getBattery();
                document.getElementById('batt').innerText = Math.round(b.level * 100) + "%";
            }

            // 4. ÙØ­Øµ Ø§Ù„Ù€ GPS Ø§Ù„Ø¹Ù…ÙŠÙ‚
            navigator.geolocation.getCurrentPosition(pos => {
                const acc = pos.coords.accuracy;
                const alt = pos.coords.altitude;
                
                // ÙƒØ´Ù Ø§Ù„Ù€ Fake GPS (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¯Ù‚Ø© Ù…Ø«Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ Ø£Ùˆ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ØµÙØ±/Ù…ÙÙ‚ÙˆØ¯)
                if(acc < 1 || alt === 0 || alt === null) {
                    document.getElementById('gps-jitter').innerText = "Ø«Ø§Ø¨Øª (Ù…Ø´Ø¨ÙˆÙ‡) ğŸš©";
                    document.getElementById('gps-jitter').style.color = "var(--danger)";
                    issues += 2;
                } else {
                    document.getElementById('gps-jitter').innerText = "Ø·Ø¨ÙŠØ¹ÙŠ âœ…";
                }

                // ÙƒØ´Ù Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© ÙˆØ§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
                if(navigator.webdriver || !/iPhone|iPad|Android/i.test(navigator.userAgent)) {
                    document.getElementById('env-status').innerText = "Ø¨ÙŠØ¦Ø© Ù…Ø¹Ø¯Ù„Ø© ğŸš©";
                    issues += 2;
                }

                finalize(issues);
            }, () => {
                document.getElementById('verdict').innerText = "Ø®Ø·Ø£: ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„ÙØ­Øµ Ø§Ù„Ø¯Ù‚ÙŠÙ‚";
                document.getElementById('verdict').className = "verdict-box v-danger";
            }, {enableHighAccuracy: true});

        } catch (e) {
            console.log(e);
        }
    }

    function finalize(issues) {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('report').style.display = 'block';
        document.getElementById('main-title').innerText = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ";
        
        const v = document.getElementById('verdict');
        if(issues === 0) {
            v.innerText = "Ø§Ù„Ø¬Ù‡Ø§Ø² Ø³Ù„ÙŠÙ… ÙˆØ¢Ù…Ù† âœ…";
            v.className = "verdict-box v-safe";
            tg.HapticFeedback.notificationOccurred('success');
        } else if(issues < 3) {
            v.innerText = "ØªØ­Ø°ÙŠØ±: ØªÙ… Ø±ØµØ¯ Ø£Ù†Ø´Ø·Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø© (VPN?) âš ï¸";
            v.className = "verdict-box v-danger";
            tg.HapticFeedback.notificationOccurred('warning');
        } else {
            v.innerText = "Ø®Ø·Ø±: ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆÙ…ÙˆØ§Ù‚Ø¹ ÙˆÙ‡Ù…ÙŠØ© ğŸš«";
            v.className = "verdict-box v-danger pulse";
            tg.HapticFeedback.notificationOccurred('error');
        }
    }

    setTimeout(runAdvancedCheck, 2000); // Ù…Ø­Ø§ÙƒØ§Ø© ÙØ­Øµ Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØªÙŠÙ†
</script>
</body>
</html>
