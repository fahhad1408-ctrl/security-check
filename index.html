<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ V5.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #121212; --danger: #ff4d4d; --safe: #00ff88; --warning: #ffcc00; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; overflow-x: hidden; }
        #start-screen { position: fixed; inset: 0; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; text-align: center; }
        .btn { background: var(--primary); color: #000; border: none; padding: 18px 50px; border-radius: 50px; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 0 20px rgba(0,209,255,0.3); }
        .report { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #222; margin-top: 10px; display: none; }
        .section-title { color: #555; font-size: 11px; margin: 15px 0 8px; border-bottom: 1px solid #222; padding-bottom: 5px; text-transform: uppercase; }
        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #1a1a1a; font-size: 13px; }
        .val { color: var(--primary); font-weight: bold; text-align: left; }
        .verdict { margin-top: 25px; padding: 18px; border-radius: 15px; text-align: center; font-weight: bold; border: 2px solid #333; font-size: 16px; }
        .loader { width: 50px; height: 50px; border: 3px solid #222; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 30px auto; display: none; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="start-screen">
    <div style="font-size: 70px; margin-bottom: 20px;">ğŸ›¡ï¸</div>
    <h2 style="letter-spacing: 1px;">Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø´Ø§Ù…Ù„</h2>
    <p style="color: #666; margin-bottom: 40px; font-size: 14px;">Ù†Ø¸Ø§Ù… ÙƒØ´Ù Ø§Ù„ØªÙ„Ø§Ø¹Ø¨ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¬Ù‡Ø§Ø²</p>
    <button class="btn" onclick="initiateDeepAudit()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ</button>
</div>

<div id="main-ui" style="display:none;">
    <h3 id="status-text" style="text-align:center; color: var(--primary);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§Øª...</h3>
    <div id="loading" class="loader"></div>

    <div id="report" class="report">
        <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¬Ù‡Ø§Ø²</div>
        <div class="item"><span>Ù†ÙˆØ¹ Ø§Ù„Ø¬ÙˆØ§Ù„:</span><span id="d_model" class="val">..</span></div>
        <div class="item"><span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„:</span><span id="d_os" class="val">..</span></div>
        <div class="item"><span>Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ´ØºÙŠÙ„:</span><span id="d_env" class="val">..</span></div>

        <div class="section-title">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</div>
        <div class="item"><span>Ø¯ÙˆÙ„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©:</span><span id="d_country" class="val">..</span></div>
        <div class="item"><span>Ù…Ø²ÙˆØ¯ Ø§Ù„Ø®Ø¯Ù…Ø© (ISP):</span><span id="d_isp" class="val">..</span></div>
        <div class="item"><span>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙØ¹Ù„ÙŠ:</span><span id="d_loc" class="val">..</span></div>

        <div class="section-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</div>
        <div class="item"><span>Ø­Ø§Ù„Ø© Ø§Ù„Ù€ VPN:</span><span id="d_vpn" class="val">..</span></div>
        <div class="item"><span>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±:</span><span id="d_dev" class="val">..</span></div>
        <div class="item"><span>ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù€ GPS:</span><span id="d_fake" class="val">..</span></div>
        
        <div id="verdict-box" class="verdict">Ø¬Ø§Ø±ÙŠ Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</div>
        <button onclick="location.reload()" style="width:100%; padding:14px; margin-top:20px; background:#1a1a1a; border:1px solid #333; color:#888; border-radius:12px; font-size:12px;">Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function initiateDeepAudit() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('main-ui').style.display = 'block';
        document.getElementById('loading').style.display = 'block';
        tg.HapticFeedback.impactOccurred('heavy');

        let risk = 0;
        let vpnActive = false;
        const ua = navigator.userAgent;

        // 1. ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù†Ø¸Ø§Ù…
        document.getElementById('d_model').innerText = /iPhone|iPad/i.test(ua) ? "Apple iPhone" : /Android/i.test(ua) ? "Android Device" : "PC/Emulator";
        document.getElementById('d_os').innerText = navigator.platform;
        
        // ÙƒØ´Ù Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ (Ø¹Ø¨Ø± Ù†Ù‚Ø§Ø· Ø§Ù„Ù„Ù…Ø³)
        if (navigator.maxTouchPoints === 0) {
            document.getElementById('d_env').innerText = "Ø¨ÙŠØ¦Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©/PC ğŸš©";
            risk += 3;
        } else {
            document.getElementById('d_env').innerText = "Ø¬ÙˆØ§Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ âœ…";
        }

        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø´Ø¨ÙƒØ© (Ù†Ø¸Ø§Ù… Fallback Ø§Ù„Ù…ØªØ¹Ø¯Ø¯)
        const apis = ['https://ipapi.co/json/', 'https://ipinfo.io/json?token=7ba0a7c473729e', 'https://extreme-ip-lookup.com/json/?key=demo'];
        let netData = null;
        for (let url of apis) {
            try {
                const res = await fetch(url);
                netData = await res.json();
                if (netData.country || netData.country_name) break;
            } catch(e) {}
        }

        if (netData) {
            document.getElementById('d_country').innerText = netData.country_name || netData.country;
            document.getElementById('d_isp').innerText = (netData.org || netData.businessName || "Ø§ØªØµØ§Ù„ Ø®Ø§Øµ").split(' ')[0];
            
            // ÙƒØ´Ù VPN Ø¹Ø¨Ø± Ø§Ù„ØªÙˆÙ‚ÙŠØª ÙˆØ§Ù„Ø¯ÙˆÙ„Ø©
            const offset = new Date().getTimezoneOffset();
            if (offset !== -180 || (netData.country_code !== 'SA' && netData.country !== 'SA')) {
                vpnActive = true;
                risk += 2;
            }
        }

        // 3. ÙØ­Øµ Ø§Ù„Ù€ GPS ÙˆØ§Ù„Ø­Ø³Ø§Ø³Ø§Øª
        navigator.geolocation.getCurrentPosition(async (pos) => {
            document.getElementById('d_vpn').innerText = vpnActive ? "Ù†Ø´Ø· (ØªÙ„Ø§Ø¹Ø¨) ğŸš©" : "ØºÙŠØ± Ù†Ø´Ø· âœ…";
            document.getElementById('d_dev').innerText = navigator.webdriver ? "Ù…ÙØ¹Ù„ ğŸš©" : "Ù…ØºÙ„Ù‚ âœ…";
            if(navigator.webdriver) risk += 2;

            // ÙƒØ´Ù Fake GPS (Ø¯Ù‚Ø© Ù…Ø±ÙŠØ¨Ø©)
            if (pos.coords.accuracy < 1) {
                document.getElementById('d_fake').innerText = "Ù…ÙƒØªØ´Ù ğŸš©";
                risk += 3;
            } else {
                document.getElementById('d_fake').innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ âœ…";
            }

            try {
                const g = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&accept-language=ar`);
                const gData = await g.json();
                document.getElementById('d_loc').innerText = (gData.address.suburb || gData.address.city || "Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚");
            } catch(e) { document.getElementById('d_loc').innerText = "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯"; }

            finalize(risk);
        }, () => finalize(risk + 5), { enableHighAccuracy: true });
    }

    function finalize(score) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('report').style.display = 'block';
        document.getElementById('status-text').innerText = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ";
        
        const b = document.getElementById('verdict-box');
        if (score === 0) {
            b.innerText = "Ø§Ù„Ø¬Ù‡Ø§Ø² Ø³Ù„ÙŠÙ… ÙˆØ¢Ù…Ù† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ…";
            b.style.color = "var(--safe)"; b.style.borderColor = "var(--safe)";
            tg.HapticFeedback.notificationOccurred('success');
        } else if (score < 4) {
            b.innerText = "ØªØ­Ø°ÙŠØ±: ØªÙ… Ø±ØµØ¯ Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© âš ï¸";
            b.style.color = "var(--warning)"; b.style.borderColor = "var(--warning)";
            tg.HapticFeedback.notificationOccurred('warning');
        } else {
            b.innerText = "Ø®Ø·Ø±: Ø¨ÙŠØ¦Ø© ØªØ´ØºÙŠÙ„ Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø£Ùˆ ÙˆÙ‡Ù…ÙŠØ© ğŸš«";
            b.style.color = "var(--danger)"; b.style.borderColor = "var(--danger)";
            tg.HapticFeedback.notificationOccurred('error');
        }
    }
</script>
</body>
</html>
