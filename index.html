<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£Ù…Ù†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d1ff; --bg: #050505; --card: #111; --danger: #ff4d4d; --safe: #00ff88; --warning: #ffcc00; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 15px; }
        .header { text-align: center; padding: 20px 0; border-bottom: 1px solid #222; margin-bottom: 20px; }
        .report { background: var(--card); border-radius: 15px; padding: 15px; border: 1px solid #222; }
        .section-title { color: var(--primary); font-size: 12px; font-weight: bold; margin: 15px 0 5px; text-transform: uppercase; border-right: 3px solid var(--primary); padding-right: 10px; }
        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #1f1f1f; font-size: 13px; }
        .val { font-weight: bold; color: #eee; text-align: left; max-width: 60%; }
        .status-ok { color: var(--safe); }
        .status-warn { color: var(--warning); }
        .status-err { color: var(--danger); }
        .verdict { margin-top: 25px; padding: 15px; border-radius: 12px; text-align: center; font-weight: bold; font-size: 16px; border: 1px solid #333; }
        .loading-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .spinner { width: 50px; height: 50px; border: 3px solid #222; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loading" class="loading-screen">
    <div class="spinner"></div>
    <p style="margin-top: 20px; color: var(--primary);">Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…...</p>
</div>

<div class="header">
    <h3>ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h3>
</div>

<div class="report">
    <div class="section-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù†Ø¸Ø§Ù…</div>
    <div class="item"><span>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²:</span><span id="device" class="val">..</span></div>
    <div class="item"><span>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„:</span><span id="os" class="val">..</span></div>
    <div class="item"><span>Ù…ØªØµÙØ­ Ø§Ù„ØªØ´ØºÙŠÙ„:</span><span id="browser" class="val">..</span></div>
    <div class="item"><span>Ø¨ÙŠØ¦Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø© (Ù…Ù„ÙØ§Øª ØªØ¹Ø±ÙŠÙ):</span><span id="profile-check" class="val">ÙØ­Øµ..</span></div>

    <div class="section-title">Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø´Ø¨ÙƒØ©</div>
    <div class="item"><span>Ø§Ù„Ø¯ÙˆÙ„Ø©:</span><span id="country" class="val">..</span></div>
    <div class="item"><span>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø­ÙŠ:</span><span id="location" class="val">..</span></div>
    <div class="item"><span>Ù…Ø²ÙˆØ¯ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª (ISP):</span><span id="isp" class="val">..</span></div>
    <div class="item"><span>Ø­Ø§Ù„Ø© Ø§Ù„Ù€ VPN:</span><span id="vpn" class="val">..</span></div>

    <div class="section-title">Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…Ø·ÙˆØ±</div>
    <div class="item"><span>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±/Ø§Ù„ØªØµØ­ÙŠØ­:</span><span id="dev-mode" class="val">..</span></div>
    <div class="item"><span>ØªÙ„Ø§Ø¹Ø¨ Ø¨Ø§Ù„Ù€ GPS:</span><span id="gps-mock" class="val">..</span></div>
    
    <div id="final-verdict" class="verdict">Ø¬Ø§Ø±ÙŠ Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ...</div>
    <button onclick="location.reload()" style="width:100%; padding:12px; margin-top:20px; background:#1a1a1a; color:#888; border:1px solid #333; border-radius:8px;">Ø¥Ø¹Ø§Ø¯Ø© ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    async function runDeepAudit() {
        let riskScore = 0;
        const ua = navigator.userAgent;

        // 1. ÙØ­Øµ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù†Ø¸Ø§Ù…
        document.getElementById('device').innerText = /iPhone|iPad|iPod/i.test(ua) ? "Apple iPhone" : /Android/i.test(ua) ? "Android Device" : "PC / Unknown";
        document.getElementById('os').innerText = navigator.platform;
        document.getElementById('browser').innerText = ua.includes("FBAN") || ua.includes("Instagram") ? "ØªØ·Ø¨ÙŠÙ‚ ÙˆØ³ÙŠØ·" : "Ù…ØªØµÙØ­ Ù†Ø¸Ø§Ù…";

        // ÙƒØ´Ù Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ¹Ø±ÙŠÙ/Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø©
        if (navigator.standalone || ua.includes('Mobile/')) {
            document.getElementById('profile-check').innerText = "Ø£ØµÙ„ÙŠØ© âœ…";
            document.getElementById('profile-check').className = "val status-ok";
        } else {
            document.getElementById('profile-check').innerText = "Ø¨ÙŠØ¦Ø© ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚Ø© âš ï¸";
            document.getElementById('profile-check').className = "val status-warn";
            riskScore++;
        }

        // 2. ÙØ­Øµ Ø§Ù„Ø´Ø¨ÙƒØ© ÙˆØ§Ù„Ù€ VPN (Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª + IP)
        try {
            const ipRes = await fetch('https://ipapi.co/json/').catch(() => null);
            const offset = new Date().getTimezoneOffset();
            if (ipRes) {
                const data = await ipRes.json();
                document.getElementById('country').innerText = data.country_name;
                document.getElementById('isp').innerText = data.org;
                
                // ØµÙŠØ¯ Ø§Ù„Ù€ VPN Ø¨Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„Ø¯ÙˆÙ„Ø©
                if (offset !== -180 || data.country_code !== 'SA') {
                    document.getElementById('vpn').innerText = "Ù†Ø´Ø· ğŸš©";
                    document.getElementById('vpn').className = "val status-err";
                    riskScore += 2;
                } else {
                    document.getElementById('vpn').innerText = "ØºÙŠØ± Ù†Ø´Ø· âœ…";
                    document.getElementById('vpn').className = "val status-ok";
                }
            }
        } catch(e) { riskScore++; }

        // 3. ÙØ­Øµ Ø§Ù„Ù€ GPS ÙˆØ§Ù„Ø­ÙŠ ÙˆÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±
        navigator.geolocation.getCurrentPosition(async (pos) => {
            // ÙƒØ´Ù ØªÙ„Ø§Ø¹Ø¨ Ø§Ù„Ù€ GPS
            if (pos.coords.accuracy < 1 || pos.coords.altitude === 0) {
                document.getElementById('gps-mock').innerText = "Ù…ÙƒØªØ´Ù ğŸš©";
                document.getElementById('gps-mock').className = "val status-err";
                riskScore += 2;
            } else {
                document.getElementById('gps-mock').innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ âœ…";
                document.getElementById('gps-mock').className = "val status-ok";
            }

            // ÙƒØ´Ù ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± (Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯)
            if (navigator.webdriver) {
                document.getElementById('dev-mode').innerText = "Ù…ÙØ¹Ù„ ğŸš©";
                document.getElementById('dev-mode').className = "val status-err";
                riskScore += 2;
            } else {
                document.getElementById('dev-mode').innerText = "Ù…ØºÙ„Ù‚ âœ…";
                document.getElementById('dev-mode').className = "val status-ok";
            }

            // Ø¬Ù„Ø¨ Ø§Ù„Ø­ÙŠ ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
            try {
                const g = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&accept-language=ar`);
                const gData = await g.json();
                document.getElementById('location').innerText = (gData.address.city || gData.address.town) + " - " + (gData.address.suburb || "ÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
            } catch(e) { document.getElementById('location').innerText = "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯"; }

            finalize(riskScore);
        }, () => finalize(riskScore + 1), { enableHighAccuracy: true });
    }

    function finalize(score) {
        document.getElementById('loading').style.display = 'none';
        const v = document.getElementById('final-verdict');
        if (score === 0) {
            v.innerText = "Ø§Ù„Ø¬Ù‡Ø§Ø² Ø³Ù„ÙŠÙ… ÙˆÙ†Ø¸ÙŠÙ âœ…";
            v.style.color = "var(--safe)";
            v.style.borderColor = "var(--safe)";
            tg.HapticFeedback.notificationOccurred('success');
        } else if (score < 3) {
            v.innerText = "ØªØ­Ø°ÙŠØ±: ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ù…Ù†ÙŠØ© Ù…ØªÙˆØ³Ø·Ø© âš ï¸";
            v.style.color = "var(--warning)";
            v.style.borderColor = "var(--warning)";
            tg.HapticFeedback.notificationOccurred('warning');
        } else {
            v.innerText = "Ø®Ø·Ø±: ØªÙ… ÙƒØ´Ù Ø£Ø¯ÙˆØ§Øª ØªÙ„Ø§Ø¹Ø¨ ÙˆØ§Ø®ØªØ±Ø§Ù‚ ğŸš«";
            v.style.color = "var(--danger)";
            v.style.borderColor = "var(--danger)";
            tg.HapticFeedback.notificationOccurred('error');
        }
    }

    setTimeout(runDeepAudit, 1500);
</script>
</body>
</html>
